<form id="weight-form" class="page">
    <div style="padding-bottom: 1em;">
        <input id="weight-input" type="number" inputmode="numeric" pattern="[0-9.]*" step="0.1" placeholder="Patient Weight" autofocus>
        <span>kgs</span>
    </div>
    <div>
        <button id="weight-ok" type="submit">OK</button>
        <button id="weight-cancel">Cancel</button>
    </div>
</form>

<script>
    // The input element is used multiple times. So, get a reference to it.
    const input = document.getElementById("weight-input");
    
    // This is the first time loading the screen, so set the weight input.
    const weight = window.app.weight;
    if (weight) {
        input.value = app.printNumber(weight, 0, 4);
    }

    // The `autofocus` attribute on the input works on *page load* for Chrome, but not in this single-page app context.
    // So, if the element does not already have focus, set the focus.
    // It's important to check `document.hasFocus` in order to avoid removing focus from an already-displayed keyboard!
    if (document.hasFocus && document.activeElement !== input) {
        input.focus();
    }

    function updateWeight(event) {
        // Only really need to call `preventDefault` and/or `stopImmediatePropagation` for the `submit` event.
        if (event.stopImmediatePropagation) event.stopImmediatePropagation();
        if (event.preventDefault) event.preventDefault();
        // The "+" is important because it converts the string to a number!
        app.weight = +input.value;
        app.navigate.prev();
    }

    function cancelWeight(event) {
        // Prevent double-events (touchstart and click) from firing with `preventDefault`.
        if (event.preventDefault) event.preventDefault();
        app.navigate.prev();
        return false; // This probably doesn't do anything, but why not?
    }

    document.getElementById("weight-form").addEventListener("submit", updateWeight);
    document.getElementById("weight-ok").addEventListener("click", updateWeight);
    document.getElementById("weight-cancel").addEventListener("click", cancelWeight);

</script>
