<form id="weight-form" class="page">
    <div class="section">
        <strong>Patient Weight</strong>
        <table class="fill-available">
            <tr>
                <!-- Why is input width 90%? Because the input is inexplicably too wide in Mobile Safari (e.g., if width is 100% or "fill-available"!) -->
                <td><input id="weight-input" type="number" inputmode="numeric" pattern="[0-9.]*" step="0.1" placeholder="" autofocus style="width: 90%"></td>
                <td style="padding: 0 4px"><span>kg</span></td>
                <td><button id="weight-clear" type="button">Clear</button></td>
            </tr>
        </table>
    </div>
    <div>
        <button id="weight-ok" type="submit">Save</button>
        <button id="weight-cancel" type="button">Cancel</button>
    </div>
</form>

<script>

(() => {
    "use strict";

    app.swipe.left = () => app.navigate.next("/html/phone/index.html", "Pedi Crisis", "swipe-left");

    // The input element is used multiple times. So, get a reference to it.
    const input = document.getElementById("weight-input");
    
    // This is the first time loading the screen, so set the weight input.
    const weight = window.app.weight;
    if (weight) {
        input.value = app.printNumber(weight, 0, 4);
    }

    // The `autofocus` attribute on the input works on *page load* for Chrome, but not in this single-page app context.
    // So, if the element does not already have focus, set the focus.
    // It's important to check `document.hasFocus` in order to avoid removing focus from an already-displayed keyboard!
    if (document.hasFocus && document.activeElement !== input) {
        input.focus();
    }

    const updateWeight = (event) => {
        // The "+" is important because it converts the string to a number!
        app.weight = +input.value;
        app.navigate.prev();
        // Don't allow the form to send an actual POST to a non-existent server.
        if (event.preventDefault) event.preventDefault();
    }

    const cancelWeight = (event) => {
        app.navigate.prev();
        // Prevent event bubbling (otherwise the form will submit)
        if (event.preventDefault) event.preventDefault();
    }

    const clearWeight = (event) => {
        input.value = null;
        // Move focus from button to input after weight is cleared.
        input.focus();
        // Prevent event bubbling (otherwise the form will submit)
        if (event.preventDefault) event.preventDefault();
    }

    document.getElementById("weight-form").addEventListener("submit", updateWeight);
    document.getElementById("weight-ok").addEventListener("click", updateWeight);
    document.getElementById("weight-cancel").addEventListener("click", cancelWeight);
    document.getElementById("weight-clear").addEventListener("click", clearWeight);

})();

</script>
